@page "/Demo/CustomerGroupAccessPage/{MasterId:int}"
@namespace Demo.Web.Pages
@inherits AccessPage<CustomerGroup, CustomerGroupMembership, Customer>
@{
    base.BuildRenderTree(__builder);
}

<div style="width:95%;margin:10px auto">
    <table style="width:100%">
        <tr>
            <td>
                <fieldset class="c-search-container">
                    <legend>پارامترهای جستجو</legend>
                </fieldset>
                <table style="width:100%">
                    <tr>
                        <td>
                            <label>نام</label>
                        </td>
                        <td>
                            <StringTextBox @bind-Value="name1" placeholder="نام/نام خانوادگی/شرکت" Search
                                           OnChange="() => { MemberGrid.EnableLoading(); }" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>همراه</label>
                        </td>
                        <td>
                            <StringTextBox @bind-Value="MemberSearch.MobileNumber" Style="direction:ltr" />
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <hr />
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: center; color: #4f9995;font-weight:bold" colspan="2">
                            <label>مشتریانی که عضو نیستند</label>
                        </td>
                    </tr>
                </table>
                <DataGrid @ref="MemberGrid" TEntity="Customer" HideInsertIcon Search="MemberSearch" TableHeight="350"
                          ConditionExpr="t => name1 == null || t.FName.Contains(name1) || t.LName.Contains(name1) || t.CompanyName.Contains(name1)">
                    <Columns>
                        <GridColumn TEntity="Customer" Field="@(t => t.CustomerType == CustomerType.Real ?  t.FName + " " + t.LName : t.CompanyName)" Title="مشتری" />
                        <GridColumn TEntity="Customer" Field="t => t.CustomerNumber.ToString()" style="width:100px" />
                        <GridColumn TEntity="Customer" Field="t => t.MobileNumber" style="width:100px" />
                    </Columns>
                </DataGrid>
            </td>
            <td style="width:85px;text-align:center">
                <CaspianForm @ref="UpsertForm" Model="UpsertData">
                    <CaspianValidationValidator ValidatorType="typeof(CustomerGroupMembershipService)" />
                    <div style="padding-top:100px;">
                        <div style="padding-bottom:15px">
                            <IconButton IconType="IconType.AngleLeft" />
                        </div>
                        <IconButton type="button"
                                    @onclick="async () =>
                                              {
                                                  BlockUI();
                                                  await base.DeleteAsync();
                                                  UnblockUI();
                                              }" IconType="IconType.AngleRight" />
                    </div>
                </CaspianForm>
            </td>
            <td>
                <fieldset class="c-search-container">
                    <legend>پارامترهای جستجو</legend>
                    <table style="width:100%">
                        <tr>
                            <td>
                                <label>نام</label>
                            </td>
                            <td>
                                <StringTextBox @bind-Value="name2" placeholder="نام/نام خانوادگی/شرکت" Search
                                               OnChange="() => { CrudGrid.EnableLoading(); }" />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>همراه</label>
                            </td>
                            <td>
                                <StringTextBox @bind-Value="SearchData.Customer.MobileNumber" Style="direction:ltr" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <hr />
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: center; color: #4f9995;font-weight:bold" colspan="2">
                                <label>مشتریانی که عضو هستند</label>
                            </td>
                        </tr>
                    </table>
                </fieldset>
                <DataGrid @ref="CrudGrid" TEntity="CustomerGroupMembership" HideInsertIcon Search="SearchData" TableHeight="350"
                          ConditionExpr="t => name2 == null || t.Customer.FName.Contains(name2) || t.Customer.LName.Contains(name2) || t.Customer.CompanyName.Contains(name2)">
                    <Columns>
                        <GridColumn TEntity="CustomerGroupMembership" Field="@(t => t.Customer.CustomerType == CustomerType.Real ?  t.Customer.FName + " " + t.Customer.LName : t.Customer.CompanyName)" Title="مشتری" />
                        <GridColumn TEntity="CustomerGroupMembership" Field="t => t.Customer.CustomerNumber.ToString()" style="width:100px" />
                        <GridColumn TEntity="CustomerGroupMembership" Field="t => t.Customer.MobileNumber" style="width:100px" />
                        <GridCommandColumns TEntity="CustomerGroupMembership" HideEdit />
                    </Columns>
                </DataGrid>
            </td>
        </tr>
    </table>
</div>

@code
{
    string name1;
    string name2;
}
